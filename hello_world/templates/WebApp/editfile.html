{% extends 'WebApp/layout/layout_main.html' %}

{% block title %}
Edit File
{% endblock %}

{% block content %}
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
            }

        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
            }

        tr:nth-child(even) {
            background-color: #dddddd;
            }
        p {
                display: inline-block;
                margin: 0;
            }

    </style>

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Pie Chart</title>
        <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    </head>

 
    <div class="container">
        <form id="editForm" method="post" action="{% url 'database_update' %}">
            {% csrf_token %}
            <table id="myTable" border="1">
                <thead>
                    <tr>
                        <th>Message</th>
                        <th>Sentiment</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for data_item in datasets %}
                        <tr>
                            <!-- Change the data_item.message to an input field within a form -->
                            <td><input type="text" name="message" value="{{ data_item.message }}" /></td>
                            <!-- Access the properties of each dataset item and display them in the table -->
                            <td>{{ data_item.sentiment_response.type }}</td>
                            <td><button type="button" onclick="removeRow(this)" class="btn btn-danger btn-rounded">Delete</button></td>
                            <!-- Add more columns as needed -->
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <button type="submit">Save Changes</button>
        
        

        <h1></h1>

        <div>
            <button onclick="addRow()" type="button" class="btn btn-warning btn-rounded">Add Row</button>
        </div>

        <div>
            <p style="font-weight: bold; margin-top:5px; margin-bottom:5px;">Title:</p>
            <p contenteditable="true">Comment from XXX restaurant</p>
            <p style="font-weight: bold;">Size:</p>
            <p>50 Kb</p>
            <p style="font-weight: bold;">Date:</p>
            <p>2023-10-22</p>
        </div>

        <div class="mb-5">
            <p>Filter Type: {{ filter_type }}</p>
            <button  onclick="update({{ filter_type }})" type="button" class="btn btn-success btn-rounded" style= "background-color: #50a060; margin-top:5px">Update</button>
            <button  onclick="cancle()" type="button" class="btn btn-light btn-rounded" style="margin-left:15px; margin-top:5px">Cancel</button>    
        </div>
        
    </form>
        <script>
            function addRow() {
                var table = document.getElementById('myTable');
                var newRow = table.insertRow(table.rows.length);
                var cell1 = newRow.insertCell(0);
                var cell2 = newRow.insertCell(1);
                var cell3 = newRow.insertCell(2);
        
                cell1.innerHTML = "Row " + table.rows.length + ", Column 1";
                cell2.innerHTML = "Row " + table.rows.length + ", Column 2";
                cell3.innerHTML = "<button onclick='removeRow(this)' button type='button' class='btn btn-danger btn-rounded'>Delete</button>";
        
                cell1.contentEditable = true;
                cell2.contentEditable = true;
                
                console.log("Add Row button pressed");
            }
        
            function removeRow(button) {
                var row = button.parentNode.parentNode;
                row.parentNode.removeChild(row);
                console.log("Delete button pressed");
            }

            function update(fid) {
                console.log("Update button pressed");
                console.log(fid);
                var tableData = [];
                $('#myTable tbody tr').each(function () {
                    var message = $(this).find('td:nth-child(1)').text();
                    
                    // Add more fields as needed

                    tableData.push({
                        'message': message,
                        
                        // Add more fields as needed
                    });
                });

                // Send data to the Django view using AJAX
                $.ajax({
                    url: '/application/files/update',
                    type: 'POST',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data': JSON.stringify(tableData),
                    },
                    success: function (response) {
                        console.log('Data updated successfully');
                    },
                    error: function (error) {
                        console.error('Error updating data:', error);
                    }
                });
            }

            function cancle(button) {
                console.log("Cancle button pressed");
            }
            function deleteFile(button) {
                console.log("File deleted");
            }
        </script>
    </div>
{% endblock %}
